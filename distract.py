from random import shuffle
from time import sleep
import json
import requests

HEADERS = {
	'Content-Type': 'application/json'
}
BASE_URL = 'http://192.168.0.51:30030'
HOME_URL = f'{BASE_URL}/api/homescreen'
NMAN_URL = f'{BASE_URL}/api/network-manager'


def get_application_ids():
	url = f'{HOME_URL}/getRunnables'
	r = requests.get(url)
	if not r.status_code == 200:
		exit()
	result = json.loads(r.text)
	runnables = result['response']['data']
	ids = [runnable['id'] for runnable in runnables]
	return ids


def show_window(application_id):
	url = f'{HOME_URL}/showWindow'
	payload = f'{{ "application_id": "{application_id}" }}'
	r = requests.post(url, data=payload, headers=HEADERS)
	if not r.status_code == 200:
		exit()
	print(f'show_window {application_id} response: {r.text}\n')


def disable_bluetooth():
	url = f'{NMAN_URL}/disable_technology'
	payload = '{ "technology" : "bluetooth" }'
	r = requests.post(url, data=payload, headers=HEADERS)
	if not r.status_code == 200:
		exit()
	print(f'disable bluetooth response: {r.text}\n')


application_ids = get_application_ids()

if 'navigation' in application_ids:
	application_ids.remove('navigation')

shuffle(application_ids)

for application_id in application_ids:
	show_window(application_id)
	sleep(1)

disable_bluetooth()